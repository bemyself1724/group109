# <center> SM3生日攻击 </center>

## 运行方式
直接运行birthday_attack.py即可，输入自选参数x进行前4x位生日碰撞攻击，输入-1时程序结束。


## 1.SM3代码的实现
SM3算法的结构可以概括成三个部分：消息填充、消息扩展、迭代压缩。

### 消息填充
SM3的消息填充步骤是以512位的数据分组作为输入的。因此，我们需要在一开始就把数据长度填充至512位的倍数。
* 1、先填充一个“1”，后面加上k个“0”。其中k是满足(n+1+k) mod 512 = 448的最小正整数。
* 2、填充一个64位大小的数据块，大端模式存放原始数据长度。<br>
  
填充规则如下图所示：
![](https://pic.imgdb.cn/item/64ca35241ddac507cc67cfe1.png)


### 消息扩展
将填充后的消息划分成512位（64字节）的消息分组。
* 对每一个512位数据分组，划分为16个消息字，并且作为生成的132个消息字的前16个。
* 用这16个消息字通过非线性函数和异或运算来递推生成剩余的116个消息字。前68个为一组，后64个为一组。


### 迭代压缩
初值IV被放在A、B、C、D、E、F、G、H八个32位变量中，压缩函数将这八个变量进行64轮迭代压缩，最后一个压缩得到的IV值作为SM3算法的输出，即256位的哈希值。压缩过程如下图所示
![](https://pic.imgdb.cn/item/64ca39641ddac507cc70e196.jpg)



## 2.生日攻击
生日攻击是指在密码学和加密学中，攻击者试图找到两个不同的消息（或数据）具有相同的哈希值。在哈希函数的输出空间中，寻找具有相同哈希值的两个不同输入被称为生日攻击。

假设哈希函数的输出长度为n位（例如，n = 256），攻击者需要寻找两个不同的输入消息，这两个消息通过哈希函数后的输出值相同。随着n的增加，生日攻击的成功概率显著增加，这是由于概率论中的生日悖论。

生日悖论的概念如下：当随机选择n个不同的元素放入一个集合中，假设集合足够大，元素数量足够多，那么在平均情况下，第一个重复的元素出现时，集合中已经有约√n个元素。

SM3为256位的哈希函数，如果我们随机选择2^130 +1个输入，根据生日攻击计算公式，找到至少两个相同哈希值的概率为99.8%,即找到了一组碰撞。

在代码实现中，随机生成两组字符明文进行SM3哈希，判断哈希值是否相等，通过暴力枚举的方式实现。

## 3.运行结果
由于2^130 +1的计算复杂度过高，因此本实验采用简化的SM3进行生日碰撞，即获得哈希值后只取前4x位进行碰撞，x为自选参数。输入-1时程序结束。运行结果如图所示：

* 通过编写的SM3.py文件进行12bit生日碰撞
![](https://pic.imgdb.cn/item/64ca450f1ddac507cc8a7aae.jpg)

* 通过gmssl库提供的SM3哈希算法进行12bit生日碰撞
![](https://pic.imgdb.cn/item/64ca45ee1ddac507cc8ce172.jpg)

* 通过gmssl库提供的SM3哈希算法进行20bit生日碰撞
  ![](https://pic.imgdb.cn/item/64ca52651ddac507cca69cf3.jpg)



##  引文参考
[1]https://blog.csdn.net/ddk3001/article/details/52647990
[2]https://blog.csdn.net/qq_40662424/article/details/121637732
